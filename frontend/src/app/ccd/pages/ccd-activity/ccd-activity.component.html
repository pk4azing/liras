<div class="section-body">
    <div class="container-fluid">
        <div class="d-flex justify-content-between align-items-center">
            <div class="header-action">
                <h1 class="page-title">{{homeTitle}}</h1>
            </div>
            <ul class="nav nav-tabs page-header-tab">
                <li (click)="switchTab('new')" class="nav-item"><a class="nav-link" [class.active]="activeTab === 'new'"
                        data-toggle="tab">New
                        Activity</a></li>
                <li (click)="switchTab('old')" class="nav-item"><a class="nav-link" [class.active]="activeTab === 'old'"
                        data-toggle="tab">Old Activity</a>
                </li>
            </ul>
        </div>
    </div>
</div>
<div class="section-body mt-4">
    <div class="container-fluid">
        <div class="tab-content">
            <div class="tab-pane fade" [ngClass]="{ 'active show': activeTab === 'new' }" id="admin-Dashboard"
                role="tabpanel">
                <div class="container-fluid">
                    <div class="card">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div class="d-flex flex-column gap-2" #activityinfo>
                                <h3 class="m-0 fs-5">
                                    <span class="fw-bold">Activity: </span>
                                    <span class="fw-normal">{{ activity?.id || '----' }}</span>
                                </h3>

                                <h3 class="m-0 fs-5">
                                    <span class="fw-bold">Date: </span>
                                    <span class="fw-normal">{{ activity?.date ? (activity?.date | date: 'shortDate') :
                                        '----' }}</span>
                                </h3>

                                <h3 class="m-0 fs-5">
                                    <span class="fw-bold">Time: </span>
                                    <span class="fw-normal">{{ activity?.date ? (activity?.date | date: 'shortTime') :
                                        '----' }}</span>
                                </h3>
                            </div>

                            <div>
                                <button mat-fab aria-label="Upload button"
                                    class="btn btn-primary rounded-circle d-flex align-items-center justify-content-center"
                                    style="width: 40px; height: 40px;">
                                    <mat-icon (click)="openUploadDialog()" class="m-0"
                                        style="font-size: 20px;">cloud_upload</mat-icon>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container-fluid mt-4">
                    <div class="row">
                        <!-- Card 1: Uploading Files -->
                        <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                            <div class="card overflow-hidden" style="min-height: 280px; max-height: 280px;">
                                <div class="card-body overflow-x-hidden overflow-y-auto" style="max-height: 270px;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div class="h5 card-title fw-bold mb-1">Uploading Files</div>
                                    </div>
                                    <div *ngIf="uploadingFiles.length === 0" class="card">
                                        <div class="text-center py-4 text-muted">
                                            <i class="fa fa-ban me-2"></i> No files are currently being uploaded.
                                        </div>
                                    </div>
                                    <div *ngFor="let file of uploadingFiles"
                                        class="d-flex align-items-center justify-content-between p-3 mb-3 rounded-3 shadow-sm border border-gray-100 animate__animated animate__fadeInLeft"
                                        [class.animate__fadeOutRight]="file.isRemoving"
                                        [class.border-primary]="file.hovered">

                                        <!-- File Info -->
                                        <div class="d-flex align-items-center" style="width: 50%; min-width: 0;">
                                            <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-2 me-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                    fill="currentColor" viewBox="0 0 16 16">
                                                    <path
                                                        d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z" />
                                                    <path
                                                        d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z" />
                                                </svg>
                                            </div>
                                            <div class="text-truncate">
                                                <p class="mb-0 small fw-medium text-truncate">{{ file.name }}</p>
                                                <p class="mb-0 text-muted small">Uploading...</p>
                                            </div>
                                        </div>

                                        <!-- Progress Info -->
                                        <div class="d-flex flex-column align-items-end" style="width: 50%;">
                                            <div class="small fw-medium mb-1">
                                                {{ file.uploadedSize }} <span class="text-primary">({{ file.progress
                                                    }}%)</span>
                                            </div>

                                            <!-- Progress Bar -->
                                            <div class="progress w-100" style="height: 6px;">
                                                <div class="progress-bar bg-primary" role="progressbar"
                                                    [style.width]="file.progress + '%'"
                                                    [attr.aria-valuenow]="file.progress" aria-valuemin="0"
                                                    aria-valuemax="100">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card 2: Validating Files -->
                        <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                            <div class="card overflow-hidden" style="min-height: 280px; max-height: 280px;">
                                <div class="card-body overflow-auto" style="max-height: 270px;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h3 class="h5 card-title fw-bold mb-1">Validating Files</h3>
                                        <p class="text-secondary mb-0">{{ validatingFiles.length }} validating</p>
                                    </div>
                                    <div *ngIf="validatingFiles.length === 0" class="card">
                                        <div class="text-center py-4 text-muted">
                                            <i class="fa fa-ban me-2"></i> No files are currently being validated.
                                        </div>
                                    </div>


                                    <div class="overflow-auto custom-scrollbar flex-grow-1"
                                        style="max-height: calc(283px - 80px);">
                                        <div *ngFor="let file of validatingFiles"
                                            class="card mb-3 border-0 shadow-sm animate__animated animate__fadeInLeft">
                                            <div class="card-body p-3">
                                                <div class="d-flex align-items-center justify-content-between">
                                                    <div class="d-flex align-items-center me-3"
                                                        style="min-width: 0; flex-grow: 1;">
                                                        <span
                                                            class="p-2 rounded-circle bg-primary-subtle text-primary me-3 d-flex align-items-center justify-content-center">
                                                            <i class="bi bi-file-earmark-check-fill fs-5"></i>
                                                        </span>
                                                        <div class="text-truncate" style="flex-grow: 1;">
                                                            <p class="h6 text-muted mb-0 text-truncate">{{ file.name }}
                                                            </p>
                                                            <small class="text-muted">Validating...</small>
                                                        </div>
                                                    </div>

                                                    <div class="d-flex align-items-center" style="flex-shrink: 0;">
                                                        <div *ngIf="file.remainingTime > 0"
                                                            class="d-flex align-items-center me-3">
                                                            <i class="bi bi-hourglass-split text-muted fs-6 me-1"></i>
                                                            <small class="text-muted">{{ file.remainingTime }}
                                                                remaining</small>
                                                        </div>
                                                        <div class="spinner-border spinner-border-sm text-primary"
                                                            role="status"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Card 3: Successful Validations -->
                        <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                            <div class="card overflow-hidden" style="min-height: 280px; max-height: 280px;">
                                <div class="card-body overflow-auto" style="max-height: 270px;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div class="h5 card-title fw-bold mb-1">Successful Validations</div>
                                    </div>
                                    <app-ccd-successful-validations
                                        [successfulFiles]="successfulFiles"></app-ccd-successful-validations>
                                </div>
                            </div>
                        </div>

                        <!-- Card 4: Failed Validations -->
                        <div class="col-lg-6 col-md-6 col-sm-12 mb-4">
                            <div class="card overflow-hidden" style="min-height: 280px; max-height: 280px;">
                                <div class="card-body overflow-auto" style="max-height: 270px;">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div class="h5 card-title fw-bold mb-1">Failed Validations</div>
                                    </div>
                                    <app-ccd-failed-validations [failedFiles]="failedFiles"
                                        (retryUpload)="handleRetryUpload()"></app-ccd-failed-validations>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="tab-pane fade" [ngClass]="{ 'active show': activeTab === 'old' }" id="admin-Activity"
                role="tabpanel">
                <div class="row clearfix row-deck">
                    <app-ccd-old-activity></app-ccd-old-activity>
                </div>
            </div>
        </div>
    </div>
</div>