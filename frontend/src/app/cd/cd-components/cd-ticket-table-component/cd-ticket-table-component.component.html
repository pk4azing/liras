<div class="overflow-hidden pt-1 rounded-2xl">

  <div class="card">
    <div class="card-body">
      <div class="row g-3 mb-4">
        <!-- All Tickets -->
        <div class="col-md-3 col-sm-6 cursor-pointer">
          <div class="card text-center shadow-sm border-2" (click)="filterByStatus('')">
            <div class="card-body py-3">
              <h6 class="card-title fw-semibold text-primary mb-1">All Tickets</h6>
              <p class="card-text text-muted m-0">{{ dataSource.data.length }} tickets</p>
            </div>
          </div>
        </div>

        <!-- Open -->
        <div class="col-md-3 col-sm-6 cursor-pointer">
          <div class="card text-center shadow-sm border-2" (click)="filterByStatus('Open')">
            <div class="card-body py-3">
              <h6 class="card-title fw-semibold text-info mb-1">Open</h6>
              <p class="card-text text-muted m-0">
                {{ getCountByStatus('Open') }} tickets
              </p>
            </div>
          </div>
        </div>

        <!-- In Progress -->
        <div class="col-md-3 col-sm-6 cursor-pointer">
          <div class="card text-center shadow-sm border-2" (click)="filterByStatus('In Progress')">
            <div class="card-body py-3">
              <h6 class="card-title fw-semibold text-warning mb-1">In Progress</h6>
              <p class="card-text text-muted m-0">
                {{ getCountByStatus('In Progress') }} tickets
              </p>
            </div>
          </div>
        </div>

        <!-- Closed / Resolved -->
        <div class="col-md-3 col-sm-6 cursor-pointer">
          <div class="card text-center shadow-sm border-2" (click)="filterByStatus('closed_group')">
            <div class="card-body py-3">
              <h6 class="card-title fw-semibold text-success mb-1">Closed / Resolved</h6>
              <p class="card-text text-muted m-0">
                {{ getCountByClosedGroup() }} tickets
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="row g-2 align-items-end mb-3 px-2">
    <div class="card p-4 bg-white rounded">
      <div class="card-body">
        <h4 class="card-title mb-4">Filter Options</h4>
        <div class="row g-3 align-items-end">
          <div class="col-md-4 col-lg-3" appCdModeDirective>
            <label for="searchInput" class="form-label fw-semibold text-secondary">Search</label>
            <input #searchInput type="text" id="searchInput" class="form-control form-control-sm form-md-lg" placeholder="Search..."
              (keyup)="applyFilter($event)">
          </div>

          <div class="col-md-4 col-lg-2">
            <label for="prioritySelect" class="form-label fw-semibold text-secondary">Priority</label>
            <select #prioritySelect  id="prioritySelect" class="form-select form-select-sm form-select-md-lg"
              (change)="applyPriorityFilter($event)">
              <option value="">All</option>
              <option value="High">High</option>
              <option value="Medium">Medium</option>
              <option value="Low">Low</option>
              <option value="Critical">Critical</option>
            </select>
          </div>

          <div class="col-md-6 col-lg-2">
            <label for="assignedToSelect" class="form-label fw-semibold text-secondary">Assigned To</label>
            <select #assignedToSelect id="assignedToSelect" class="form-select form-select-sm form-select-md-lg"
              [disabled]="assignedToList.length === 0" (change)="applyAssignedToFilter($event)">
              <option value="">All</option>
              <option *ngFor="let cdassigned_to of assignedToList" [value]="cdassigned_to">
                {{ cdassigned_to }}
              </option>
            </select>
          </div>

          <div class="col-md-6 col-lg-2">
            <label for="createdBySelect" class="form-label fw-semibold text-secondary">Created By</label>
            <select #createdBySelect id="createdBySelect" class="form-select form-select-sm form-select-md-lg"
              [disabled]="createdByList.length === 0" (change)="applyCreatedByFilter($event)">
              <option value="">All</option>
              <option *ngFor="let createdBy of createdByList" [value]="createdBy">
                {{ createdBy }}
              </option>
            </select>
          </div>

          <div class="col-12 col-lg-1 d-grid gap-2">
            <button type="button"
              class="btn btn-primary px-3 py-2 d-flex align-items-center justify-content-center gap-2"
              (click)="resetFilters()">
              <i class="fa fa-refresh fa-sm"></i>
              <span class="d-none d-sm-inline">Reset</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-0">
    <div class="table-responsive rounded">
      <ng-container *ngIf="dataSource.data.length > 0; else noData">

        <ng-container *ngIf="dataSource.filteredData.length > 0; else noResultsFound">
          <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)"
            class="table table-hover table-vcenter table-striped table-custom mb-0" appCdModeDirective>

            <!-- Ticket ID -->
            <ng-container matColumnDef="ticket_id">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="tableheaderbg">Ticket ID</th>
              <td mat-cell *matCellDef="let element" (click)="navigateToTicket(element.ticket_id)"
                class="border-0 text-primary text-decoration-underline cursor-pointer">
                {{ element.ticket_id }}
              </td>
            </ng-container>

            <!-- Summary -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="tableheaderbg">Title</th>
              <td mat-cell *matCellDef="let element" class="border-0 textcol">
                {{ element.description }}
              </td>
            </ng-container>

            <!-- Priority -->
            <ng-container matColumnDef="priority">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="tableheaderbg">Priority</th>
              <td mat-cell *matCellDef="let element" class="border-0 textcol">
                {{ element.priority }}
              </td>
            </ng-container>

            <!-- Created By -->
            <ng-container matColumnDef="created_by">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="tableheaderbg">Created By</th>
              <td mat-cell *matCellDef="let element" class="border-0 textcol">
                {{ element.created_by }}
              </td>
            </ng-container>

            <!-- Created Date -->
            <ng-container matColumnDef="created_date">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="tableheaderbg">Created Date
              </th>
              <td mat-cell *matCellDef="let element" class="border-0 textcol">
                {{ element.created_date }}
              </td>
            </ng-container>

            <!-- Status -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="tableheaderbg">Status</th>
              <td mat-cell *matCellDef="let element" class="border-0 textcol">
                {{ element.status }}
              </td>
            </ng-container>

            <!-- Assigned To -->
            <ng-container matColumnDef="cdassigned_to">
              <th mat-header-cell *matHeaderCellDef mat-sort-header class="tableheaderbg">Assigned To</th>
              <td mat-cell *matCellDef="let element" class="border-0 textcol">
                {{ element.cdassigned_to }}
              </td>
            </ng-container>

            <!-- Header and Row definitions -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <div appCdModeDirective>
            <mat-paginator class="custom-paginator" [pageSizeOptions]="pageSizeOptions" [pageSize]="pageSize"
              showFirstLastButtons></mat-paginator>
          </div>
        </ng-container>
      </ng-container>

      <!-- No Results Found after Filter -->
      <ng-template #noResultsFound>
        <div class="text-center py-4 text-muted">
          <i class="fa fa-search me-2"></i> No matching results found.
          <div class="mt-3">
            <button class="btn btn-outline-secondary btn-sm" (click)="resetFilters()">Clear Search</button>
          </div>
        </div>
      </ng-template>

      <!-- No Data Available -->
      <ng-template #noData>
        <div class="text-center py-4 text-muted">
          <i class="fa fa-ban me-2"></i> No tickets to display.
        </div>
      </ng-template>
    </div>
  </div>

</div>