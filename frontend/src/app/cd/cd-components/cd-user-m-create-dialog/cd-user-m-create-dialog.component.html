<div appCdModeDirective>
  <div class="p-4 overflow-auto col">
    <h3 class="h5 fw-semibold border-bottom mb-4">Add New User</h3>
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="needs-validation" appCdModeDirective novalidate>
      <div class="mb-3" appCdModeDirective>
        <label>Full Name</label>
        <input type="text" formControlName="name" class="form-control"
          [ngClass]="{ 'is-invalid': userForm.get('name')?.invalid && userForm.get('name')?.touched }" />
        <div class="invalid-feedback" *ngIf="userForm.get('name')?.hasError('required')">
          Name is required
        </div>
      </div>

      <div class="mb-3">
        <label>Phone Number</label>
        <ngx-intl-tel-input [preferredCountries]="preferredCountries" [enableAutoCountrySelect]="true"
          [enablePlaceholder]="true" [searchCountryFlag]="true"
          [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]" [selectFirstCountry]="false"
          [selectedCountryISO]="CountryISO.India" [maxLength]="15" [phoneValidation]="true"
          [separateDialCode]="true" [numberFormat]="PhoneNumberFormat.National" name="phone" formControlName="phone"
          class="w-100">
        </ngx-intl-tel-input>
        <div class="invalid-feedback d-block"
          *ngIf="userForm.get('phone')?.invalid && userForm.get('phone')?.touched">
          Valid phone number is required
        </div>
      </div>

      <div class="mb-3">
        <label>Email</label>
        <input type="email" formControlName="email" class="form-control"
          [ngClass]="{ 'is-invalid': userForm.get('email')?.invalid && userForm.get('email')?.touched }" />
        <div class="invalid-feedback" *ngIf="userForm.get('email')?.hasError('required')">
          Email is required
        </div>
        <div class="invalid-feedback"
          *ngIf="userForm.get('email')?.hasError('email') || userForm.get('email')?.hasError('pattern')">
          Please enter a valid email address
        </div>
      </div>

      <div class="mb-3">
        <label>Role</label>
        <select formControlName="role" class="form-select"
          [ngClass]="{ 'is-invalid': userForm.get('role')?.invalid && userForm.get('role')?.touched }">
          <option value="" disabled selected>Select a role</option>
          <option value="user">User</option>
          <option value="admin">Admin</option>
          <option value="manager">Manager</option>
          <option value="sales">Sales</option>
        </select>
        <div class="invalid-feedback" *ngIf="userForm.get('role')?.hasError('required')">
          Role is required
        </div>
      </div>

      <div class="mb-3" *ngIf="userForm.get('role')?.value === 'sales'">
        <label>Associated Client</label>
        <input type="text" formControlName="associatedClient" class="form-control"
          [ngClass]="{ 'is-invalid': userForm.get('associatedClient')?.invalid && userForm.get('associatedClient')?.touched }" />
        <div class="invalid-feedback" *ngIf="userForm.get('associatedClient')?.hasError('required')">
          Associated client is required for sales role
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-3">
        <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid">Submit</button>
      </div>
    </form>
  </div>
</div>